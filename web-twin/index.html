<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pendulum Digital Twin</title>
  </head>
  <body>
    <div id="app">
      <!-- Left Panel: NEAT Training -->
      <div id="neat-panel">
        <h2>üß¨ NEAT Training</h2>
        
        <!-- Tabs -->
        <div class="neat-tabs">
          <button class="neat-tab active" data-tab="swing-up">üöÄ Swing-Up</button>
          <button class="neat-tab" data-tab="balance">‚öñ Balance</button>
          <button class="neat-tab" data-tab="sklearn">ü§ñ Sklearn RL</button>
        </div>
        
        <!-- Training Controls -->
        <div class="control-row">
          <button id="btn-start-training" class="control-btn neat-btn">
            ‚ñ∂ Start
          </button>
          <button id="btn-stop-training" class="control-btn stop-btn" style="display: none;">
            ‚èπ Stop
          </button>
        </div>
        
        <!-- NEAT Training Content (Swing-Up and Balance) -->
        <div id="neat-training-content">
          <div class="training-stats">
            <div class="stat-row">
              <span class="stat-label">Generation:</span>
              <span id="train-generation" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Best Fitness:</span>
              <span id="train-best-fitness" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Avg Fitness:</span>
              <span id="train-avg-fitness" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Species:</span>
              <span id="train-species" class="stat-value">0</span>
            </div>
          </div>
          
          <div class="fitness-graph">
            <canvas id="fitness-canvas" width="280" height="80"></canvas>
          </div>
          
          <h3>Config</h3>
          
          <div class="config-row">
            <label>Population</label>
            <input type="number" id="neat-pop-size" value="100" min="10" max="5000">
          </div>
          
          <div class="config-row">
            <label>Max Speed</label>
            <input type="number" id="neat-max-speed" value="9000" min="1000" max="500000" step="1000">
          </div>
          
          <div class="config-row">
            <label>Sim Steps</label>
            <input type="number" id="neat-sim-steps" value="2000" min="100" max="10000" step="100">
          </div>
          
          <!-- Balance-specific perturbation parameters -->
          <div id="balance-perturbation-config" style="display: none;">
            <div class="config-row">
              <label>Angle Pert (¬∞)</label>
              <input type="number" id="neat-angle-perturbation" value="10" min="0" max="90" step="1">
            </div>
            <div class="config-row">
              <label>Vel Pert (rad/s)</label>
              <input type="number" id="neat-velocity-perturbation" value="0.5" min="0" max="10" step="0.1">
            </div>
          </div>
          
          <div class="control-row" style="margin-top: 8px;">
            <button id="btn-apply-neat-config" class="control-btn">
              Apply Config
            </button>
          </div>
          
          <h3>Best Genome</h3>
          
          <div id="best-genome-info" class="genome-info">
            <div class="stat-row">
              <span class="stat-label">Fitness:</span>
              <span id="genome-fitness" class="stat-value">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Nodes:</span>
              <span id="genome-nodes" class="stat-value">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Connections:</span>
              <span id="genome-connections" class="stat-value">-</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Saved:</span>
              <span id="genome-saved-at" class="stat-value">-</span>
            </div>
          </div>
          
          <div class="control-row" style="margin-top: 8px;">
            <button id="btn-delete-best" class="control-btn delete-btn">
              üóëÔ∏è Delete Best
            </button>
          </div>
        </div>
        
        <!-- Sklearn RL Training Content -->
        <div id="sklearn-training-content" style="display: none;">
          <div class="training-stats">
            <div class="stat-row">
              <span class="stat-label">Episode:</span>
              <span id="sklearn-episode" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Best Reward:</span>
              <span id="sklearn-best-reward" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Last Reward:</span>
              <span id="sklearn-last-reward" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Exploration:</span>
              <span id="sklearn-exploration" class="stat-value">0.1</span>
            </div>
          </div>
          
          <div class="fitness-graph">
            <canvas id="sklearn-reward-canvas" width="280" height="80"></canvas>
          </div>
          
          <h3>Config</h3>
          
          <div class="config-row">
            <label>Episodes</label>
            <input type="number" id="sklearn-episodes" value="1000" min="100" max="10000" step="100">
          </div>
          
          <div class="config-row">
            <label>Max Speed</label>
            <input type="number" id="sklearn-max-speed" value="9000" min="1000" max="500000" step="1000">
          </div>
          
          <div class="config-row">
            <label>Sim Steps</label>
            <input type="number" id="sklearn-sim-steps" value="5000" min="100" max="10000" step="100">
          </div>
          
          <div class="control-row" style="margin-top: 8px;">
            <button id="btn-apply-sklearn-config" class="control-btn">
              Apply Config
            </button>
          </div>
        </div>
      </div>
      
      <div id="pendulum-container" class="disconnected">
        <div id="loading-spinner" class="loading-spinner">
          <div class="spinner"></div>
          <span>Waiting for connection...</span>
        </div>
      </div>
      <div id="info-panel">
        <h1>Pendulum Digital Twin</h1>
        <div id="status">Connecting...</div>
        
        <div id="mode-display">
          Mode: <span id="current-mode">idle</span>
        </div>
        
        <div id="stats">
          <div class="stat-box">
            <span class="stat-label">Angle</span>
            <span id="angle-value" class="stat-value">0.0</span>¬∞
          </div>
          <div class="stat-box">
            <span class="stat-label">Velocity</span>
            <span id="velocity-value" class="stat-value">0.0</span>¬∞/s
          </div>
          <div class="stat-box">
            <span class="stat-label">Motor</span>
            <span id="motor-value" class="stat-value">0</span> st/s
          </div>
        </div>
        
        <div id="position-display">
          <div class="position-header">
            <span class="stat-label">Cart Position</span>
            <span id="position-value">0</span>
          </div>
          <div class="position-track">
            <div class="limit-indicator left" id="limit-left"></div>
            <div class="position-marker" id="position-marker"></div>
            <div class="limit-indicator right" id="limit-right"></div>
          </div>
          <div class="position-labels">
            <span>‚Üê Left Limit</span>
            <span>Right Limit ‚Üí</span>
          </div>
          <div class="limit-positions">
            <span id="limit-left-pos">--</span>
            <span id="limit-right-pos">--</span>
          </div>
        </div>

        <div id="controls">
          <h2>Controls</h2>
          
          <div class="control-row" style="margin-bottom: 8px;">
            <label style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-dim);">
              <input type="checkbox" id="accel-mode-toggle" style="width: 16px; height: 16px;">
              <span>Acceleration Mode</span>
            </label>
          </div>
          
          <div class="control-row">
            <button id="btn-left" class="control-btn hold-btn" data-mode-start="manual_left" data-mode-stop="idle">
              ‚Üê Left
            </button>
            <button id="btn-right" class="control-btn hold-btn" data-mode-start="manual_right" data-mode-stop="idle">
              Right ‚Üí
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-oscillate" class="control-btn toggle-btn" data-mode="oscillate">
              ‚Üï Oscillate
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-neat-swingup" class="control-btn toggle-btn neat-btn" data-mode="neat_swing_up_only">
              üöÄ Swing Up
            </button>
            <button id="btn-neat-balance-run" class="control-btn toggle-btn balance-btn" data-mode="neat_balance_only">
              ‚öñ Balance
            </button>
            <button id="btn-sklearn-rl" class="control-btn toggle-btn neat-btn" data-mode="sklearn_rl">
              ü§ñ Sklearn RL
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-stop" class="control-btn stop-btn" data-mode="idle">
              ‚èπ Stop
            </button>
            <button id="btn-zero" class="control-btn zero-btn">
              üéØ Zero
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-home" class="control-btn home-btn">
              üè† Home
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-upload" class="control-btn upload-btn">
              üì§ Upload Arduino Code
            </button>
          </div>
          <div id="upload-status"></div>
        </div>

        <div id="config">
          <h2>Configuration</h2>
          
          <div class="config-section">
            <h3>Manual Mode</h3>
            <div class="slider-row">
              <label>Speed</label>
              <input type="range" id="cfg-manual-speed" min="0" max="10000" value="1000" data-cfg="manual_speed">
              <span class="slider-value" id="val-manual-speed">1000</span>
            </div>
            <div class="slider-row">
              <label>Acceleration</label>
              <input type="range" id="cfg-manual-accel" min="1000" max="500000" step="1000" value="50000" data-cfg="manual_accel">
              <span class="slider-value" id="val-manual-accel">50000</span>
            </div>
          </div>
          
          <div class="config-section">
            <h3>Oscillate Mode</h3>
            <div class="slider-row">
              <label>Speed</label>
              <input type="range" id="cfg-osc-speed" min="500" max="20000" value="3000" data-cfg="oscillate_speed">
              <span class="slider-value" id="val-osc-speed">3000</span>
            </div>
            <div class="slider-row">
              <label>Period (s)</label>
              <input type="range" id="cfg-osc-period" min="0.5" max="5" step="0.1" value="2" data-cfg="oscillate_period">
              <span class="slider-value" id="val-osc-period">2.0</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
