<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pendulum Digital Twin</title>
  </head>
  <body>
    <div id="app">
      <!-- Left Panel: Training -->
      <div id="neat-panel">
        <h2>üß¨ Training</h2>
        
        <!-- Tabs -->
        <div class="neat-tabs">
          <button class="neat-tab active" data-tab="evotorch">üß¨ EvoTorch</button>
        </div>
        
        <!-- Training Controls -->
        <div class="control-row">
          <button id="btn-start-training" class="control-btn neat-btn">
            ‚ñ∂ Start
          </button>
          <button id="btn-stop-training" class="control-btn stop-btn" style="display: none;">
            ‚èπ Stop
          </button>
        </div>
        
        <!-- EvoTorch Training Content -->
        <div id="evotorch-training-content">
          <div class="training-stats">
            <div class="stat-row">
              <span class="stat-label">Generation:</span>
              <span id="evotorch-generation" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Best Fitness:</span>
              <span id="evotorch-best-fitness" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Current Fitness:</span>
              <span id="evotorch-current-fitness" class="stat-value">0</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Population:</span>
              <span id="evotorch-population" class="stat-value">50</span>
            </div>
          </div>
          
          <div class="fitness-graph">
            <canvas id="evotorch-fitness-canvas" width="280" height="80"></canvas>
          </div>
          
          <h3>Generation History</h3>
          <div id="evotorch-generation-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #333; padding: 8px; margin-bottom: 12px; background: #1a1a1a;">
            <div style="color: #888; font-size: 12px;">Loading generations...</div>
          </div>
          
          <h3>Population Records</h3>
          <div style="margin-bottom: 8px;">
            <input type="number" id="evotorch-view-generation" placeholder="Generation" value="" min="1" style="width: 80px; margin-right: 8px;">
            <button id="btn-view-population" class="control-btn" style="display: inline-block;">View Population</button>
          </div>
          <div id="evotorch-population-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #333; padding: 8px; margin-bottom: 12px; background: #1a1a1a; display: none;">
            <div style="color: #888; font-size: 12px;">Select a generation to view population</div>
          </div>
          
          <h3>Config</h3>
          
          <div class="config-row">
            <label>Generations</label>
            <input type="number" id="evotorch-generations" value="100" min="10" max="10000" step="10">
          </div>
          
          <div class="config-row">
            <label>Population Size</label>
            <input type="number" id="evotorch-population-size" value="50" min="10" max="500" step="10">
          </div>
          
          <div class="config-row">
            <label>Max Speed</label>
            <input type="number" id="evotorch-max-speed" value="9000" min="1000" max="500000" step="1000">
          </div>
          
          <div class="config-row">
            <label>Sim Steps</label>
            <input type="number" id="evotorch-sim-steps" value="5000" min="100" max="10000" step="100">
          </div>
          
          <div class="control-row" style="margin-top: 8px;">
            <button id="btn-apply-evotorch-config" class="control-btn">
              Apply Config
            </button>
          </div>
        </div>
      </div>
      
      <div id="pendulum-container" class="disconnected">
        <div id="loading-spinner" class="loading-spinner">
          <div class="spinner"></div>
          <span>Waiting for connection...</span>
        </div>
      </div>
      <div id="info-panel">
        <h1>Pendulum Digital Twin</h1>
        <div id="status">Connecting...</div>
        
        <div id="mode-display">
          Mode: <span id="current-mode">idle</span>
        </div>
        
        <div id="stats">
          <div class="stat-box">
            <span class="stat-label">Angle</span>
            <span id="angle-value" class="stat-value">0.0</span>¬∞
          </div>
          <div class="stat-box">
            <span class="stat-label">Velocity</span>
            <span id="velocity-value" class="stat-value">0.0</span>¬∞/s
          </div>
          <div class="stat-box">
            <span class="stat-label">Motor</span>
            <span id="motor-value" class="stat-value">0</span> st/s
          </div>
        </div>
        
        <div id="position-display">
          <div class="position-header">
            <span class="stat-label">Cart Position</span>
            <span id="position-value">0</span>
          </div>
          <div class="position-track">
            <div class="limit-indicator left" id="limit-left"></div>
            <div class="position-marker" id="position-marker"></div>
            <div class="limit-indicator right" id="limit-right"></div>
          </div>
          <div class="position-labels">
            <span>‚Üê Left Limit</span>
            <span>Right Limit ‚Üí</span>
          </div>
          <div class="limit-positions">
            <span id="limit-left-pos">--</span>
            <span id="limit-right-pos">--</span>
          </div>
        </div>

        <div id="controls">
          <h2>Controls</h2>
          
          <div class="control-row">
            <button id="btn-left" class="control-btn hold-btn" data-mode-start="manual_left" data-mode-stop="idle">
              ‚Üê Left
            </button>
            <button id="btn-right" class="control-btn hold-btn" data-mode-start="manual_right" data-mode-stop="idle">
              Right ‚Üí
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-oscillate" class="control-btn toggle-btn" data-mode="oscillate">
              ‚Üï Oscillate
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-evotorch-balance" class="control-btn toggle-btn neat-btn" data-mode="evotorch_balance">
              üß¨ EvoTorch
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-stop" class="control-btn stop-btn" data-mode="idle">
              ‚èπ Stop
            </button>
            <button id="btn-zero" class="control-btn zero-btn">
              üéØ Zero
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-home" class="control-btn home-btn">
              üè† Home
            </button>
          </div>
          
          <div class="control-row">
            <button id="btn-upload" class="control-btn upload-btn">
              üì§ Upload Arduino Code
            </button>
          </div>
          <div id="upload-status"></div>
        </div>

        <div id="config">
          <h2>Configuration</h2>
          
          <div class="config-section">
            <h3>Manual Mode</h3>
            <div class="slider-row">
              <label>Acceleration</label>
              <input type="range" id="cfg-manual-accel" min="1000" max="50000" step="1000" value="50000" data-cfg="manual_accel">
              <span class="slider-value" id="val-manual-accel">50000</span>
            </div>
          </div>
          
          <div class="config-section">
            <h3>Oscillate Mode</h3>
            <div class="slider-row">
              <label>Speed</label>
              <input type="range" id="cfg-osc-speed" min="500" max="20000" value="3000" data-cfg="oscillate_speed">
              <span class="slider-value" id="val-osc-speed">3000</span>
            </div>
            <div class="slider-row">
              <label>Period (s)</label>
              <input type="range" id="cfg-osc-period" min="0.5" max="5" step="0.1" value="2" data-cfg="oscillate_period">
              <span class="slider-value" id="val-osc-period">2.0</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
